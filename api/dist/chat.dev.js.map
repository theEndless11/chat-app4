{"version":3,"sources":["chat.js"],"names":["require","Server","module","exports","req","res","setHeader","io","socket","server","console","log","on","data","username","emit","status","broadcast","message","timestamp","Date","toLocaleTimeString","newMessage","isPrivate","sender","receiver","to","send"],"mappings":";;eAAmBA,OAAO,CAAC,WAAD,C;IAAlBC,M,YAAAA,M;;AAERC,MAAM,CAACC,OAAP,GAAiB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC3BA,EAAAA,GAAG,CAACC,SAAJ,CAAc,eAAd,EAA+B,qBAA/B,EAD2B,CAC6B;;AAExD,MAAMC,EAAE,GAAG,IAAIN,MAAJ,CAAWI,GAAG,CAACG,MAAJ,CAAWC,MAAtB,CAAX,CAH2B,CAK3B;;AACA,MAAI,CAACJ,GAAG,CAACG,MAAJ,CAAWC,MAAX,CAAkBF,EAAvB,EAA2B;AACvBG,IAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACAN,IAAAA,GAAG,CAACG,MAAJ,CAAWC,MAAX,CAAkBF,EAAlB,GAAuBA,EAAvB,CAFuB,CAIvB;;AACAA,IAAAA,EAAE,CAACK,EAAH,CAAM,YAAN,EAAoB,UAACJ,MAAD,EAAY;AAC5BE,MAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAD4B,CAG5B;;AACAH,MAAAA,MAAM,CAACI,EAAP,CAAU,eAAV,EAA2B,UAACC,IAAD,EAAU;AAAA,YACzBC,QADyB,GACZD,IADY,CACzBC,QADyB;AAEjCN,QAAAA,MAAM,CAACO,IAAP,CAAY,aAAZ,EAA2B;AAAED,UAAAA,QAAQ,EAARA,QAAF;AAAYE,UAAAA,MAAM,EAAE;AAApB,SAA3B;AACAR,QAAAA,MAAM,CAACS,SAAP,CAAiBF,IAAjB,CAAsB,aAAtB,EAAqC;AAAED,UAAAA,QAAQ,EAARA;AAAF,SAArC;AACH,OAJD,EAJ4B,CAU5B;;AACAN,MAAAA,MAAM,CAACI,EAAP,CAAU,cAAV,EAA0B,UAACC,IAAD,EAAU;AAAA,YACxBC,QADwB,GACFD,IADE,CACxBC,QADwB;AAAA,YACdI,OADc,GACFL,IADE,CACdK,OADc;AAEhC,YAAMC,SAAS,GAAG,IAAIC,IAAJ,GAAWC,kBAAX,EAAlB;AACA,YAAMC,UAAU,GAAG;AAAER,UAAAA,QAAQ,EAARA,QAAF;AAAYI,UAAAA,OAAO,EAAPA,OAAZ;AAAqBC,UAAAA,SAAS,EAATA,SAArB;AAAgCI,UAAAA,SAAS,EAAE;AAA3C,SAAnB;AACAhB,QAAAA,EAAE,CAACQ,IAAH,CAAQ,aAAR,EAAuBO,UAAvB;AACH,OALD,EAX4B,CAkB5B;;AACAd,MAAAA,MAAM,CAACI,EAAP,CAAU,sBAAV,EAAkC,UAACC,IAAD,EAAU;AAAA,YAChCW,MADgC,GACFX,IADE,CAChCW,MADgC;AAAA,YACxBC,QADwB,GACFZ,IADE,CACxBY,QADwB;AAAA,YACdP,OADc,GACFL,IADE,CACdK,OADc;AAExC,YAAMC,SAAS,GAAG,IAAIC,IAAJ,GAAWC,kBAAX,EAAlB;AACA,YAAMC,UAAU,GAAG;AAAER,UAAAA,QAAQ,EAAEU,MAAZ;AAAoBN,UAAAA,OAAO,EAAPA,OAApB;AAA6BC,UAAAA,SAAS,EAATA,SAA7B;AAAwCI,UAAAA,SAAS,EAAE;AAAnD,SAAnB;;AACA,YAAIE,QAAJ,EAAc;AACVlB,UAAAA,EAAE,CAACmB,EAAH,CAAMD,QAAN,EAAgBV,IAAhB,CAAqB,qBAArB,EAA4CO,UAA5C;AACH;AACJ,OAPD,EAnB4B,CA4B5B;;AACAd,MAAAA,MAAM,CAACI,EAAP,CAAU,YAAV,EAAwB,YAAM;AAC1BF,QAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACH,OAFD;AAGH,KAhCD;AAiCH;;AAEDN,EAAAA,GAAG,CAACsB,IAAJ,CAAS,0BAAT;AACH,CA/CD","sourcesContent":["const { Server } = require('socket.io');\r\n\r\nmodule.exports = (req, res) => {\r\n    res.setHeader('Cache-Control', 'no-store, max-age=0');  // Prevent caching\r\n\r\n    const io = new Server(res.socket.server);\r\n    \r\n    // Enable WebSocket connection on Vercel's serverless functions\r\n    if (!res.socket.server.io) {\r\n        console.log('New socket.io server');\r\n        res.socket.server.io = io;\r\n        \r\n        // Handle connections and broadcasting\r\n        io.on('connection', (socket) => {\r\n            console.log('A user connected');\r\n            \r\n            // Handle user registration\r\n            socket.on('register_user', (data) => {\r\n                const { username } = data;\r\n                socket.emit('user_status', { username, status: 'online' });\r\n                socket.broadcast.emit('user_joined', { username });\r\n            });\r\n\r\n            // Handle public messages\r\n            socket.on('send_message', (data) => {\r\n                const { username, message } = data;\r\n                const timestamp = new Date().toLocaleTimeString();\r\n                const newMessage = { username, message, timestamp, isPrivate: false };\r\n                io.emit('new_message', newMessage);\r\n            });\r\n\r\n            // Handle private messages\r\n            socket.on('send_private_message', (data) => {\r\n                const { sender, receiver, message } = data;\r\n                const timestamp = new Date().toLocaleTimeString();\r\n                const newMessage = { username: sender, message, timestamp, isPrivate: true };\r\n                if (receiver) {\r\n                    io.to(receiver).emit('new_private_message', newMessage);\r\n                }\r\n            });\r\n\r\n            // Handle disconnections\r\n            socket.on('disconnect', () => {\r\n                console.log('A user disconnected');\r\n            });\r\n        });\r\n    }\r\n    \r\n    res.send('Socket.io server running');\r\n};\r\n"],"file":"chat.dev.js"}